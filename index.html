<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>DHAFIZ777-GACHA VIP</title>
<style>
body{margin:0;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;font-family:Arial,sans-serif;color:#fff;background:radial-gradient(circle at top,#1b0033,#000);overflow:hidden;}
h1{margin-bottom:6px;font-size:38px;text-shadow:0 0 25px #00ffe0;} 
#limitText{margin-top:15px;font-size:16px;text-shadow:0 0 12px #00ffcc;}
#gift{font-size:260px;cursor:pointer;user-select:none;margin-bottom:20px;transition:transform .3s;}
#gift:hover{transform:scale(1.05);}
#gift.disabled{opacity:.4;pointer-events:none;}
.shake{animation:shake .5s infinite} 
@keyframes shake{0%{transform:rotate(0)}25%{transform:rotate(3deg)}50%{transform:rotate(0)}75%{transform:rotate(-3deg);}}
.controls{margin-top:10px} 
button{padding:10px 18px;border-radius:20px;border:none;font-weight:bold;cursor:pointer;transition:.3s;}
button:hover{filter:brightness(1.2);}
.modeBtn{width:220px;height:48px;font-size:16px;border-radius:22px;cursor:pointer;}
.modeFree{background:#00ff6a;color:#000;}
.modePremium{background:#00ffe0;color:#000;}
.admin{background:#111;color:#fff;border:2px solid #00ff6a}
.admin.active{background:#ff5252;color:#000}
.popup{position:fixed;inset:0;background:rgba(0,0,0,.85);backdrop-filter:blur(14px);display:none;justify-content:center;align-items:center;z-index:100;transition:.3s;opacity:0;}
.popup.show{display:flex;opacity:1;}
.popupBox{background:linear-gradient(135deg,#000,#111);padding:40px 55px;border-radius:28px;box-shadow:0 0 80px #00ffcc;text-align:center;transform:scale(0.8);transition:transform .3s;}
.popup.show .popupBox{transform:scale(1);}
.popupText{font-size:32px;font-weight:bold;margin-bottom:20px;text-shadow:0 0 15px #00ffe0;}
input{margin-top:12px;padding:12px;width:100%;border-radius:14px;border:none;outline:none;font-size:16px;background:#111;color:#fff;text-align:center;}
#submitLogin{margin-top:18px;background:#00ffe0;color:#000;width:50%;font-weight:bold;font-size:16px;}
#toast{position:fixed;bottom:20px;background:#111;padding:10px 18px;border-radius:20px;opacity:0;transition:.3s;}
.secretSpecial {color:#1de9b6;text-shadow:0 0 10px #1de9b6,0 0 20px #1de9b6,0 0 30px #00ffdd;animation:secretPulse 1s infinite alternate;}
.mythicSpecial {color:#ff5252;text-shadow:0 0 15px #ff5252,0 0 25px #ff0000;animation:secretPulse 1s infinite alternate;}
@keyframes secretPulse{0%{transform:scale(1);}50%{transform:scale(1.3) rotate(10deg);}100%{transform:scale(1.2) rotate(-10deg);}}
</style>
</head>
<body>
<h1>üéÅ DHAFIZ777-GACHA VIP</h1>
<div id="limitText"></div>
<div id="gift" onclick="prepareGift()">üéÅ</div>

<div class="controls">
 <button id="adminBtn" class="admin" onclick="activateAdminAbuse()">ADMIN ABUSE ‚ùå</button>
 <button class="admin" onclick="showVipPasswordManager()">Kelola Password VIP</button>
</div>

<div class="controls">
  <input id="giftAmount" type="number" placeholder="Jumlah spin kado" style="width:120px;margin-right:5px;">
  <button class="admin" onclick="addGiftsToAll()">Tambah Kado Semua</button>
</div>

<div id="popup" class="popup">
 <div class="popupBox">
  <div class="popupText" id="popupText">Harap Masukan Nama Discord Anda</div>
  <input id="usernameInput" placeholder="Nama Discord">
  <button id="submitLogin" onclick="createOrLoginUser()">SUBMIT</button>
 </div>
</div>

<div id="modeSelect" style="display:none">
 <div class="popupBox" style="text-align:center;">
  <h2>PROTECTION</h2>
  <div style="font-size:14px;color:#00ffcc;margin-bottom:15px;">SECURE GACHA SYSTEM</div>
  <button class="modeBtn modeFree" onclick="selectFree()">üÜì FREE MODE</button>
  <br><br>
  <input id="premiumKey" placeholder="Masukan key VIP/Premium">
  <br><br>
  <button class="modeBtn modePremium" onclick="selectPremium()">üíé PREMIUM MODE</button>
 </div>
</div>

<div id="vipPopup" class="popup">
  <div class="popupBox">
    <div class="popupText">Tambah / Lihat Password VIP</div>
    <input id="newVipPassword" placeholder="Masukkan password VIP baru">
    <button onclick="addVipPassword()">Tambah Password</button>
    <div id="vipList" style="margin-top:15px;max-height:200px;overflow-y:auto;color:#00ffe0;"></div>
    <button onclick="vipPopupClose()">Tutup</button>
  </div>
</div>

<div id="toast"></div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
<script>
window.supabaseClient = window.supabaseClient || supabase.createClient(
  "https://gacha-xyz.supabase.co",
  "sb_publishable_rBYeUnQhRrkGCM9OPq3jSA_nPL_zX5q"
);
const supabase = window.supabaseClient;

const WEBHOOK="https://discord.com/api/webhooks/1450407026332270714/YUCosS--Bjud-m8oX_j84L8R44fGXHB_LHnf_0qAT48Pa99J_xbKDuDSwI83kLUlauit";
const gift=document.getElementById("gift");
const popup=document.getElementById("popup");
const popupText=document.getElementById("popupText");
const usernameInput=document.getElementById("usernameInput");
const toastEl=document.getElementById("toast");
const limitText=document.getElementById("limitText");
const adminBtn=document.getElementById("adminBtn");
const modeSelect=document.getElementById("modeSelect");
const premiumKey=document.getElementById("premiumKey");
const vipPopup=document.getElementById("vipPopup");
const vipList=document.getElementById("vipList");
const newVipPassword=document.getElementById("newVipPassword");

let username=sessionStorage.getItem("username")||"";
let mode=null,gachaLimit=0,adminAbuse=false,opening=false,lastSpin=0;
let deviceId = localStorage.getItem("device_id");
if(!deviceId){deviceId = crypto.randomUUID(); localStorage.setItem("device_id", deviceId);}

const rateFree=[{n:"ZONK ‚ö´",c:"zonk",p:50},{n:"RARE üîµ",c:"rare",p:30},{n:"EPIC üü£",c:"epic",p:15},{n:"LEGENDARY üü°",c:"legendary",p:4},{n:"MYTHIC üî¥",c:"mythic",p:0.5},{n:"SECRET üü¢",c:"secret",p:0.5}];
const ratePremium=[{n:"ZONK ‚ö´",c:"zonk",p:40},{n:"RARE üîµ",c:"rare",p:30},{n:"EPIC üü£",c:"epic",p:15},{n:"LEGENDARY üü°",c:"legendary",p:10},{n:"MYTHIC üî¥",c:"mythic",p:3},{n:"SECRET üü¢",c:"secret",p:2}];
const rateAdmin=[{n:"ZONK ‚ö´",c:"zonk",p:20},{n:"RARE üîµ",c:"rare",p:20},{n:"EPIC üü£",c:"epic",p:20},{n:"LEGENDARY üü°",c:"legendary",p:15},{n:"MYTHIC üî¥",c:"mythic",p:10},{n:"SECRET üü¢",c:"secret",p:15}];

function toast(msg){toastEl.textContent=msg;toastEl.style.opacity=1;setTimeout(()=>toastEl.style.opacity=0,1500);}
function prepareGift(){if(!username){popup.classList.add("show");return;} openGift();}
async function createOrLoginUser(){
    const uname=usernameInput.value.trim();
    if(!uname) return toast("Masukkan nama Discord!");
    const {data,error}=await supabase.from('gacha_users').select('*').eq('device_id',deviceId).single();
    if(error || !data){
        await supabase.from('gacha_users').insert({device_id:deviceId, username:uname, spins_free:3, spins_premium:0, created_at:new Date()});
        toast("Akun berhasil dibuat!");
    } else {
        if(data.username!==uname) return toast("Username salah!");
        toast("Login berhasil!");
    }
    username=uname;
    sessionStorage.setItem("username",username);
    popup.classList.remove("show");
    modeSelect.style.display="flex";
}

function roll(){let table=mode==="FREE"?rateFree:ratePremium;if(adminAbuse) table=rateAdmin;let r=Math.random()*100,t=0;for(let i of table){t+=i.p;if(r<=t) return i;}}

async function openGift(){if(opening||gachaLimit<=0) return toast("Gacha habis");if(Date.now()-lastSpin<1200) return;lastSpin=Date.now();if(gachaLimit!==Infinity) gachaLimit--;update();gift.classList.add("shake");setTimeout(async()=>{gift.classList.remove("shake");const p=roll();popupText.className=p.n==="SECRET üü¢"?"popupText secretSpecial":p.n==="MYTHIC üî¥"?"popupText mythicSpecial":"popupText "+p.c;popupText.textContent=p.n;popup.classList.add("show");opening=false;sendDiscord(p.n,mode);},1300);}

function activateAdminAbuse(){const key=prompt("Masukkan key Admin Abuse");if(key!=="davzstore") return toast("Key salah!");adminAbuse=true;toast("Admin Abuse AKTIF untuk semua device!");update();}

function sendDiscord(result,modeType){const colorMap={"ZONK ‚ö´":0x777777,"RARE üîµ":0x03a9f4,"EPIC üü£":0x9c27b0,"LEGENDARY üü°":0xffeb3b,"MYTHIC üî¥":0xff5252,"SECRET üü¢":0x1de9b6};const title=(modeType==="FREE")?"üéÅ FREE GACHA":"üéÅ PREMIUM GACHA";fetch(WEBHOOK,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({embeds:[{title:title,description:username+" | "+result,color:colorMap[result]||0x00ff00}]})});}

function selectFree(){mode="FREE";gachaLimit=3;modeSelect.style.display="none";update();}
function selectPremium(){const key=premiumKey.value.trim();if(!key) return toast("Masukkan key");mode="PREMIUM";gachaLimit=3;modeSelect.style.display="none";update();}

function vipPopupClose(){vipPopup.classList.remove('show');}
async function showVipPasswordManager(){if(prompt("Password admin")!=="davzstore") return toast("Password salah!");vipPopup.classList.add('show');loadVipPasswords();}
async function loadVipPasswords(){const {data}=await supabase.from('vip_passwords').select('*');vipList.innerHTML="";data.forEach(pw=>{vipList.innerHTML+=`<div>${pw.password} | Max Spin: ${pw.spins_allowed}</div>`});}
async function addVipPassword(){const pw=newVipPassword.value.trim();if(!pw) return toast("Masukkan password!");let spinsAllowed=adminAbuse?6:3;await supabase.from('vip_passwords').upsert({password:pw,spins_allowed:spinsAllowed});toast("Password VIP berhasil ditambahkan: "+pw);newVipPassword.value="";loadVipPasswords();}

async function addGiftsToAll(){if(prompt("Password admin")!=="davzstore") return toast("Password salah!");let amount = parseInt(document.getElementById('giftAmount').value) || 1; const {data,error} = await supabase.from('gacha_users').select('*'); if(error) return toast("Gagal menambahkan kado semua"); for(let user of data){let newSpin = (user.spins_free || 0) + amount; await supabase.from('gacha_users').update({spins_free:newSpin}).eq('device_id', user.device_id);}toast("Berhasil menambahkan "+amount+" spin ke semua akun!");}

function update(){limitText.textContent=(mode||"MODE")+" | SISA GACHA: "+(gachaLimit===Infinity?"‚àû":gachaLimit);gift.classList.toggle("disabled",gachaLimit<=0 && gachaLimit!==Infinity);adminBtn.classList.toggle("active",adminAbuse);}

if(!username) popup.classList.add("show");
update();
</script>
</body>
</html>
